# NetServer

参照muduo编写了多线程事件驱动型的网络库，目的是巩固C++知识，学习编码规范、多线程中对象的生命周期管理、网络编程框架等知识。NetServer采用主从Reactor模型（所谓Reactor模式，是有一个循环的过程，监听对应事件是否触发，触发时调用对应的callback进行处理）来实现NetServer。主线程负责监控连接事件，将连接分配给IO线程池。IO线程池负责处理连接的事件，处理后分发给worker线程池进行处理。应用层实现了http服务器对http请求的解析处理，还可根据需求编写应用层服务。

* 基于非阻塞epoll的IO复用机制实现Reactor模式。
* 设计了IO线程池与worker线程池。IO线程池采用基于one loop per thread模式用于监听处理事件（socket读写事件、定时器事件）；worker线程池用于处理耗时任务。
* 使用了eventfd实现了跨线程唤醒，保证对象的线程安全。
* 基于时间轮timing wheel来踢除空闲的连接。使用了循环队列与哈希表来存放各个时间段即将超时的连接（轮上的连接使用shared_ptr）。当连接超时，其智能指针的引用计数减为0，调用析构函数关闭连接。
* 采用智能指针来管理多线程下的对象资源。
* 采用多缓冲技术实现了异步日志，前端使用API接口生成日志消息；后端线程负责将日志消息写到本地文件，并且实现了指定日志大小或周期到达后进行日志滚动，每秒可写入上百万条日志。

## TODO
* 无锁队列优化生产者消费者模型（锁的粒度小，争用导致线程频繁调度）
* 协程替换线程（使用协程的本质是去优化同步IO？，需配合异步来感知事件完成事件？）